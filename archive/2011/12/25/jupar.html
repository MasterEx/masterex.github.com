<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<link rel="icon" href="../../../../images/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="../../../../images/favicon.ico" type="image/x-icon" />
<title>JUPAR: Updating Java desktop applications made easy!</title>
<link rel="stylesheet" href="../../../../styles/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="../../../../styles/blog.css" type="text/css" />
<script type="text/javascript">window.location="http://sopastrike.com/strike";</script></head>
<body>
        <div id="layout-menu-box">
                <div id="layout-menu">
                        <div id="menu">
                                <ul>
                                        <li><a href="../../../../archive.rss"><img width="32" alt="rss" src="../../../../images/rss.png" /></a></li>
                                        <li><a href="../../../../about.html">About</a></li>
                                        <li><a href="../../../../archive.html">Archive</a></li>
                                        <li><a href="../../../../index.html">Home</a></li>
                                </ul>
                        </div>
                </div>
        </div>
        <div id="layout-banner-box">
                <div id="layout-banner">
                        <div id="layout-description">Periklis Ntanasis:</div>
                        <div id="layout-title">Master's Touch</div>
                </div>
        </div>
        <div id="layout-content-box">
                <div id="layout-content">
                <p><img id="top_fade" src="../../../../images/top-fade.png" alt="fade out" /></p>
<div id="header">
<h1>JUPAR: Updating Java desktop applications made easy!</h1>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>A neat feature for a desktop application is to automatically notify
the user for available updates or even provide automatic updating functionality.</p></div>
<div class="paragraph"><p>Building such an architecture seemed interesting to me, so out of curiosity
I&#8217;ve decided to implement a library and an architecture that can provide that
kind of functionality.</p></div>
<div class="paragraph"><p>I&#8217;ve created JUPAR wihch stands up for Java Updates Architecture! It is pretty simple
and it&#8217;s main purpose is to act as a proof of concept for how
this functionality could be implemented but one could easily use it in
a real world application as well.</p></div>
<div class="paragraph"><p>As you can easily assume I have implemented this concept to work with Java
desktop applications <strong>but the same concept could easily be implemented in
any other language too</strong>.</p></div>
<div class="paragraph"><p>Below I&#8217;ll explain how this architecture works and later there will be
a demostration.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph"><p>First of all the application checks if there is a newer version available.</p></div>
<div class="paragraph"><p>It is doing this by checking an xml file located somewhere in a remote
server. I am using xml files because they are easily configurable and Java
has a built in API for parsing them.</p></div>
<div class="paragraph"><p>So, when this is done we can notify the user that a new version is available
and prompt him to manually download and install it or allow the application
to perfom an automatic update.</p></div>
<div class="paragraph"><p>Let&#8217;s assume now that an automatic update takes place. The application parses
another xml file which contains links with all the files that we are going to need for
the update.</p></div>
<div class="paragraph"><p>Then all the needed files are downloaded and stored in a temporary directory.
There, there is also an xml file with the instructions. Instructions are the steps
that our application needs to follow in order to be updated.</p></div>
<div class="paragraph"><p>There are 3 kind of instructions.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>MOVE</strong>: Moves a new file in the place of an old one
</p>
</li>
<li>
<p>
<strong>DELETE</strong>: Deletes an old file
</p>
</li>
<li>
<p>
<strong>EXECUTE</strong>: Executes a new file (a jar actually)
</p>
</li>
</ul></div>
<div class="paragraph"><p>The purpose of <strong>MOVE</strong> and <strong>DELETE</strong> is pretty obvious. The purpose of <strong>EXECUTE</strong> is
to perform advanced operations such as updating a database scheme. This
keeps JUPAR complexity low and provides more flexibility to the developer.</p></div>
<div class="paragraph"><p>The hole procedure is described to the next figure.</p></div>
<div class="paragraph"><p><span class="image">
<img src="jupar.png" alt="JUPAR Architecture" />
</span></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_demonstration">Demonstration</h2>
<div class="sectionbody">
<div class="paragraph"><p>Ok, let&#8217;s now see it in action!</p></div>
<div class="paragraph"><p>I have built a dump application that displays the application version.
We are going to see both the code that we should include in our application
and the xml files that we should create!</p></div>
<div class="paragraph"><p>Here is the relevant code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Check for new version</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #009900">int</span> answer <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #008080">Release</span> release <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Release</span></span><span style="color: #990000">();</span>
release<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setpkgver</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"1.0"</span><span style="color: #990000">);</span>
release<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setPkgrel</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"1"</span><span style="color: #990000">);</span>
<span style="color: #008080">ReleaseXMLParser</span> parser <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ReleaseXMLParser</span></span><span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
  <span style="color: #008080">Release</span> current <span style="color: #990000">=</span>
      parser<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">parse</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://niovi.aueb.gr/~p3070130/latest.xml"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>URL<span style="color: #990000">);</span>
  <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>current<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">compareTo</span></span><span style="color: #990000">(</span>release<span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    answer <span style="color: #990000">=</span>
        JOptionPane<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">showConfirmDialog</span></span><span style="color: #990000">(</span>rootPane<span style="color: #990000">,</span> <span style="color: #FF0000">"A new version of this"</span>
        <span style="color: #990000">+</span> <span style="color: #FF0000">" program is available</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Would you like to install it?"</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"Update"</span><span style="color: #990000">,</span> JOptionPane<span style="color: #990000">.</span>YES_NO_OPTION<span style="color: #990000">,</span> JOptionPane<span style="color: #990000">.</span>INFORMATION_MESSAGE<span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">switch</span></span> <span style="color: #990000">(</span>answer<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">0</span><span style="color: #990000">:</span>
        <span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         * Download needed files</span></span>
<span style="font-style: italic"><span style="color: #9A1900">         */</span></span>
        <span style="color: #008080">Downloader</span> dl <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Downloader</span></span><span style="color: #990000">();</span>
        dl<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">download</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://niovi.aueb.gr/~p3070130/files.xml"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"tmp"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>URL<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
      <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> <span style="color: #993399">1</span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">break</span></span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">SAXException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  JOptionPane<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">showMessageDialog</span></span><span style="color: #990000">(</span>rootPane<span style="color: #990000">,</span> <span style="color: #FF0000">"The xml wasn't loaded succesfully!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
      <span style="color: #FF0000">"Something went wrong!"</span><span style="color: #990000">,</span> JOptionPane<span style="color: #990000">.</span>WARNING_MESSAGE<span style="color: #990000">);</span>
  Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  answer <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">FileNotFoundException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  JOptionPane<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">showMessageDialog</span></span><span style="color: #990000">(</span>rootPane<span style="color: #990000">,</span>
      <span style="color: #FF0000">"Files were unable to be read or created successfully!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
      <span style="color: #990000">+</span> <span style="color: #FF0000">"Please be sure that you have the right permissions and"</span>
      <span style="color: #990000">+</span> <span style="color: #FF0000">" internet connectivity!"</span><span style="color: #990000">,</span>
      <span style="color: #FF0000">"Something went wrong!"</span><span style="color: #990000">,</span> JOptionPane<span style="color: #990000">.</span>WARNING_MESSAGE<span style="color: #990000">);</span>
  Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  answer <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">IOException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  JOptionPane<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">showMessageDialog</span></span><span style="color: #990000">(</span>rootPane<span style="color: #990000">,</span> <span style="color: #FF0000">"IOEXception!"</span><span style="color: #990000">,</span>
      <span style="color: #FF0000">"Something went wrong!"</span><span style="color: #990000">,</span> JOptionPane<span style="color: #990000">.</span>WARNING_MESSAGE<span style="color: #990000">);</span>
  Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  answer <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">InterruptedException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  JOptionPane<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">showMessageDialog</span></span><span style="color: #990000">(</span>rootPane<span style="color: #990000">,</span> <span style="color: #FF0000">"The connection has been lost!</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
      <span style="color: #990000">+</span> <span style="color: #FF0000">"Please check your internet connectivity!"</span><span style="color: #990000">,</span>
      <span style="color: #FF0000">"Something went wrong!"</span><span style="color: #990000">,</span> JOptionPane<span style="color: #990000">.</span>WARNING_MESSAGE<span style="color: #990000">);</span>
  Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  answer <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Start the updating procedure</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>answer <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">Updater</span> update <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Updater</span></span><span style="color: #990000">();</span>
    update<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"update.xml"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"tmp"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>FILE<span style="color: #990000">);</span>
    JOptionPane<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">showMessageDialog</span></span><span style="color: #990000">(</span>rootPane<span style="color: #990000">,</span>
        <span style="color: #FF0000">"The update was completed successfuly.</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span>
        <span style="color: #990000">+</span> <span style="color: #FF0000">"Please restart the application in order the changes take effect."</span><span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">SAXException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">InterruptedException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">FileNotFoundException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">IOException</span> ex<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    Logger<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLogger</span></span><span style="color: #990000">(</span>JUPARDemo<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getName</span></span><span style="color: #990000">()).</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>Level<span style="color: #990000">.</span>SEVERE<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span> ex<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/**</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Delete tmp directory</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #008080">File</span> tmp <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">File</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"tmp"</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>tmp<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exists</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #008080">File</span> file <span style="color: #990000">:</span> tmp<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">listFiles</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
    file<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">delete</span></span><span style="color: #990000">();</span>
  <span style="color: #FF0000">}</span>
  tmp<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">delete</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Let&#8217;s see the highlights!</p></div>
<div class="sect2">
<h3 id="_check_for_new_version">Check for new version</h3>
<div class="paragraph"><p>We set this applications version and release number. So version is a float number
such as 1.0 , 1.1 etc and release is an integer starting from 1 and counting.</p></div>
<div class="paragraph"><p>Then we set the remote xml with the current release info. Here is an example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="color: #009900">encoding</span><span style="color: #990000">=</span><span style="color: #FF0000">"UTF-8"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;information&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;pubDate&gt;</span></span>Sat, 24 Dec 2011 19:58:42 +0200<span style="font-weight: bold"><span style="color: #0000FF">&lt;/pubDate&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;pkgver&gt;</span></span>1.0<span style="font-weight: bold"><span style="color: #0000FF">&lt;/pkgver&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;pkgrel&gt;</span></span>2<span style="font-weight: bold"><span style="color: #0000FF">&lt;/pkgrel&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;severity&gt;</span></span>normal<span style="font-weight: bold"><span style="color: #0000FF">&lt;/severity&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;extra&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;message&gt;&lt;/message&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;/extra&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/information&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Message can be a short description of the update that you can display to
the user or something like that.</p></div>
<div class="paragraph"><p>Severity can be used as you wish. You may for example perform automatic
updates only when severity is high or whatever you like.</p></div>
<div class="paragraph"><p>Back to the code, the Release Class implements the comparable interface
so we can directly compare two different releases.</p></div>
<div class="paragraph"><p>In this demo, if a new release is available an option dialog is displayed
asking the user if he wants to update or not. As I said before one could just
notify the user for the new version and don&#8217;t perform an automatic update.</p></div>
<div class="paragraph"><p>Anyway, if the answer is positive we parse the <span class="red">files.xml</span> file and download
the needed files. Here how <span class="red">files.xml</span> looks like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="color: #009900">encoding</span><span style="color: #990000">=</span><span style="color: #FF0000">"UTF-8"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;download&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;file&gt;</span></span>http://niovi.aueb.gr/~p3070130/update.xml<span style="font-weight: bold"><span style="color: #0000FF">&lt;/file&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;file&gt;</span></span>http://niovi.aueb.gr/~p3070130/JUPARDemo.jar<span style="font-weight: bold"><span style="color: #0000FF">&lt;/file&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/download&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>All the files are stored in a temporary directory.</p></div>
</div>
<div class="sect2">
<h3 id="_automatic_update">Automatic Update</h3>
<div class="paragraph"><p>When the update starts we parse the instructions file which is by then stored
 localy.
This is the last xml file and looks like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="color: #009900">encoding</span><span style="color: #990000">=</span><span style="color: #FF0000">"UTF-8"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;update&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;instruction&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;action&gt;</span></span>MOVE<span style="font-weight: bold"><span style="color: #0000FF">&lt;/action&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;file&gt;</span></span>JUPARDemo.jar<span style="font-weight: bold"><span style="color: #0000FF">&lt;/file&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;destination&gt;</span></span>JUPARDemo.jar<span style="font-weight: bold"><span style="color: #0000FF">&lt;/destination&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;/instruction&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/update&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The above xml file contains an instruction that moves the new file JUPARDemo.jar
from the temporary directory to the current working directory (see below)
in the place of the old JUPARDemo.jar.</p></div>
<div class="paragraph"><p>Finally we delete the temporary directory.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pros_and_cons">Pros and Cons</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_advantages">Advantages</h3>
<div class="paragraph"><p>JUPAR is pretty small and simple. Everyone could easily hack its code
and add the kind of functionality that she needs. It&#8217;s pretty flexible, developer
handles all the exceptions as she wants. It doesn&#8217;t require any server
side software installed, it just needs some xml files in the right place!</p></div>
</div>
<div class="sect2">
<h3 id="_disadvantages">Disadvantages</h3>
<div class="paragraph"><p>Lack of documentation.</p></div>
<div class="paragraph"><p>All the exceptions are thrown for the developer to handle them.
However, some times it&#8217;s not clear where the exception occurred. For example
a method may throw IOException both when a file isn&#8217;t accessible through
network or it hasn&#8217;t permissions to write a file locally. Most of the times
this isn&#8217;t important as the developer will log the error and get the
exact line where the exception occurred, however if we care to show an
appropriate message to the user this is a problem.</p></div>
<div class="paragraph"><p>Temporary files are stored to the <strong>current working directory</strong> and files are
copied/deleted to/from the <strong>current working directory</strong>.</p></div>
<div class="paragraph"><p>For example if our working directory is curdir and we execute our application
like <span class="blue">java -jar dist/JUPARDemo.jar</span> the
<span class="green">tmp</span> file will be created in the <span class="green">curdir</span> directory and then the new JUPARDemo.jar file
will be copied to <span class="green">curdir</span> too.</p></div>
<div class="paragraph"><p>After some though Java doesn&#8217;t provides a clear way of finding the executable&#8217;s
path. So, I have included an update method that takes also the executable&#8217;s
path as an argument and let&#8217;s up to the developer how to handle this.</p></div>
<div class="paragraph"><p>In my account there are 3 possible ways to do this.</p></div>
<div class="sect3">
<h4 id="_find_the_executable_path_with_java">Find the executable path with Java</h4>
<div class="paragraph"><p>You can try to find the executables path with a command like:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">File</span></span><span style="color: #990000">(</span>MyClass<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getProtectionDomain</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">getCodeSource</span></span><span style="color: #990000">()</span>
<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLocation</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">toURI</span></span><span style="color: #990000">().</span>g‌​<span style="font-weight: bold"><span style="color: #000000">etPath</span></span><span style="color: #990000">());</span></tt></pre></div></div>
<div class="paragraph"><p>However I am not sure if this works in every case and as far as I know it
doesn&#8217;t works for JVMs previous to 1.5.</p></div>
</div>
<div class="sect3">
<h4 id="_use_a_predefined_path">Use a predefined path</h4>
<div class="paragraph"><p>It is possible to use a predefined path in your Java application.</p></div>
<div class="paragraph"><p>There are 2 supported ways to accomplish this.</p></div>
<div class="sect4">
<h5 id="_first_way">First way</h5>
<div class="paragraph"><p>Use a full path to set the temporary directory:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>dl<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">download</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://niovi.aueb.gr/~p3070130/files.xml"</span><span style="color: #990000">,</span>
 <span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist/tmp"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>URL<span style="color: #990000">);</span>
<span style="color: #990000">...</span>
update<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"update.xml"</span><span style="color: #990000">,</span>
<span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist/tmp"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>FILE<span style="color: #990000">);</span>
<span style="color: #990000">...</span>
<span style="color: #008080">File</span> tmp <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">File</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist/tmp"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>And then have an <span class="red">update.xml</span> with also full paths.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">&lt;?xml</span></span> <span style="color: #009900">version</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="color: #009900">encoding</span><span style="color: #990000">=</span><span style="color: #FF0000">"UTF-8"</span><span style="font-weight: bold"><span style="color: #000080">?&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;update&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;instruction&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;action&gt;</span></span>MOVE<span style="font-weight: bold"><span style="color: #0000FF">&lt;/action&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;file&gt;</span></span>JUPARDemo.jar<span style="font-weight: bold"><span style="color: #0000FF">&lt;/file&gt;</span></span>
   <span style="font-weight: bold"><span style="color: #0000FF">&lt;destination&gt;</span></span>/home/periklis/Workspace/JUPARDEMO/dist/JUPARDemo.jar<span style="font-weight: bold"><span style="color: #0000FF">&lt;/destination&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/instruction&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/update&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>This is how demo fullv1 and fullv2 that comes with JUPAR is implemented.</p></div>
</div>
<div class="sect4">
<h5 id="_second_way">Second way</h5>
<div class="paragraph"><p>This way is actually like the first one but it doesn&#8217;t need a modified
<span class="red">updates.xml</span>. As I mentioned before, after some consideration I decided
to provide an update method that takes the executable&#8217;s full path as an argument.</p></div>
<div class="paragraph"><p>So we only need to have something like that:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>dl<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">download</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://niovi.aueb.gr/~p3070130/files.xml"</span><span style="color: #990000">,</span>
 <span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist/tmp"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>URL<span style="color: #990000">);</span>
<span style="color: #990000">...</span>
update<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"update.xml"</span><span style="color: #990000">,</span>
<span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist/tmp"</span><span style="color: #990000">,</span>
<span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist"</span><span style="color: #990000">,</span> Modes<span style="color: #990000">.</span>FILE<span style="color: #990000">);</span>
<span style="color: #990000">...</span>
<span style="color: #008080">File</span> tmp <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">File</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/home/periklis/Workspace/JUPARDEMO/dist/tmp"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Both first and second way work but comes with a great limitation. The
developer should maintain different versions of the executable for
every different system that she wants to deploy it.
Ok, in a way this is how things work in the linux world where the package
maintainer maintains a package adjusted to her distribution. However,
this shouldn&#8217;t be considered as granted so I&#8217;ll continue with the 3rd approach
that I think is the most smooth.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_predefined_path_from_local_configuration">Use a predefined path from local configuration</h4>
<div class="paragraph"><p>This way is actually like the above with the difference that the developer
will read the executable&#8217;s path from a configuration file. This has the
avantage that the package maintainer doesn&#8217;t need to recompile the application
to add the full path.</p></div>
<div class="paragraph"><p>By convention the configuration file could be in <span class="green">/home/user/.appname</span> in
linux systems and to the corresponding in Windows.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_disadvantages_conclusion">Disadvantages Conclusion</h3>
<div class="paragraph"><p>There are some problems into JUPAR but the developer can easily overcome them
and that is due to JUPAR&#8217;s flexibility. If there is a best way to overcome
a problem one could easily implement it into JUPAR and share some love :)</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todo_list">Todo List</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are some thoughts that I may look into the future:</p></div>
<div class="ulist"><ul>
<li>
<p>
Store the file/filepaths as File objects and not as Strings
</p>
</li>
<li>
<p>
Throw more detailed Exceptions
</p>
</li>
<li>
<p>
Let the methods that use an URLConnection to set the timeout value
</p>
</li>
<li>
<p>
Write some documentation
</p>
</li>
<li>
<p>
Add JSON and maybe plain text support other than xml
</p>
</li>
<li>
<p>
Test it!
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">See Also</div><ul>
<li>
<p>
<a href="https://github.com/MasterEx/jupar/tree/master/src/jupar">JUPAR source code and demos</a>
</p>
</li>
<li>
<p>
<a href="http://stackoverflow.com/questions/320542/how-to-get-the-path-of-a-running-jar-file">How to get the path of a running jar file?</a>
</p>
</li>
<li>
<p>
<a href="http://stackoverflow.com/questions/305461/automatic-updates-of-java-desktop-application">How do you remotely update Java applications?</a>
</p>
</li>
</ul></div>
</div>
</div>
<h2>Comments</h2>
<p>
    <div id="disqus_thread"></div>
    <script type="text/javascript" src="http://disqus.com/forums/masterstouch/embed.js"></script>
    <noscript><a href="http://masterstouch.disqus.com/?url=ref">View the discussion thread.</a></noscript>
</p>
<p><img id="bottom_fade" src="../../../../images/bottom-fade.png" alt="fade out" />     </p>
                </div>
        </div>
        <p id="footer">Designed by Periklis Ntanasis
        <br />
        <a href="http://validator.w3.org/check?uri=referer">
  <img style="border-width:0"
    src="../../../../images/xhtml11.png"
    alt="Valid XHTML 1.1" />
</a>
<a href="http://jigsaw.w3.org/css-validator/">
  <img style="border-width:0"
    src="../../../../images/css.png"
    alt="Valid CSS!" />
</a>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/gr/"><img alt="Creative Commons License" style="border-width:0" src="../../../../images/sa.png" /></a>
<a rel="license" href="https://github.com/MasterEx/AsciiBlog"><img alt="Powered by Ascii Blog" style="border-width:0" src="../../../../images/asciiblog.png" /></a>
</p>
</body>
</html>
